!function(){"use strict";angular.module("multiselect-searchtree",[])}(),function(){"use strict";var e=angular.module("multiselect-searchtree");e.controller("multiSelectTreeCtrl",["$scope","$document",function(e,t){function c(){l(),e.$apply()}function l(){e.showTree=!1,r&&(r.isActive=!1,r=void 0),t.off("click",c)}function n(t){for(var c=0,l=t.length;l>c;c++)i(t[c])||t[c].selected!==!0?i(t[c])&&t[c].selected===!1&&(t[c].selected=!0):e.selectedItems.push(t[c]),t[c]&&t[c].children&&n(t[c].children)}function i(t){var c=!1;if(e.selectedItems)for(var l=0;l<e.selectedItems.length;l++)if(e.selectedItems[l].id===t.id){c=!0;break}return c}var r;e.showTree=!1,e.selectedItems=[],e.multiSelect=e.multiSelect||!1,e.onActiveItem=function(e){r!==e&&(r&&(r.isActive=!1),r=e,r.isActive=!0)},e.refreshOutputModel=function(){e.outputModel=angular.copy(e.selectedItems)},e.refreshSelectedItems=function(){e.selectedItems=[],e.inputModel&&n(e.inputModel)},e.deselectItem=function(t,c){c.stopPropagation(),e.selectedItems.splice(e.selectedItems.indexOf(t),1),t.selected=!1,this.refreshOutputModel()},e.onControlClicked=function(l){l.stopPropagation(),e.showTree=!e.showTree,e.showTree&&t.on("click",c)},e.onFilterClicked=function(e){e.stopPropagation()},e.clearFilter=function(t){t.stopPropagation(),e.filterKeyword=""},e.canSelectItem=function(t){return e.callback({item:t,selectedItems:e.selectedItems})},e.itemSelected=function(t){function c(l){l.forEach(function(l){t.selected&&!l.selected?e.selectedItems.push(l):!t.selected&&l.selected&&e.selectedItems.splice(e.selectedItems.indexOf(l),1),l.selected=t.selected,l.children&&l.children.length>0&&c(l.children)})}if(!(e.useCallback&&e.canSelectItem(t)===!1||e.selectOnlyLeafs&&t.children&&t.children.length>0)){if(e.multiSelect){t.selected=!0;var n=e.selectedItems.indexOf(t);i(t)?(t.selected=!1,e.selectedItems.splice(n,1)):e.selectedItems.push(t),t.children&&t.children.length>0&&c(t.children)}else{l();for(var r=0;r<e.selectedItems.length;r++)e.selectedItems[r].selected=!1;t.selected=!0,e.selectedItems=[],e.selectedItems.push(t)}this.refreshOutputModel()}},e.onSelectAll=function(e,t){function c(e){e.selected=!0,e.children.length>0&&e.children.forEach(function(e){c(e)})}e.forEach(function(e){c(e)}),this.refreshSelectedItems(),this.refreshOutputModel()},e.onClearAll=function(e,t){function c(e){e.selected=!1,e.children.length>0&&e.children.forEach(function(e){c(e)})}e.forEach(function(e){c(e)}),this.refreshSelectedItems(),this.refreshOutputModel()}}]),e.directive("multiselectSearchtree",function(){return{restrict:"E",templateUrl:"src/multiselect-searchtree.tpl.html",scope:{inputModel:"=",outputModel:"=?",multiSelect:"=?",selectOnlyLeafs:"=?",callback:"&",defaultLabel:"@",extraButtons:"=?",directSearch:"=?",filterType:"@"},link:function(e,t,c){function l(e){return e.replace(/á/g,"a").replace(/é/g,"e").replace(/í/g,"i").replace(/ó/g,"o").replace(/ú/g,"u")}function n(e,t){for(var c=i(e,[]),n=0,r=c.length;r>n;n++)if(-1!==l(c[n].name.toLowerCase()).indexOf(l(t.toLowerCase())))return!1;return!0}function i(e,t){for(var c=0;c<e.children.length;c++)t.push(e.children[c]),i(e.children[c],t);return t}function r(e){e.isFiltered=!1,void 0!=e.p&&r(e.p)}function o(t,c){-1!==l(t.name.toLowerCase()).indexOf(l(e.filterKeyword.toLowerCase()))?r(t):t.isFiltered=!0,t.children.length>0&&angular.forEach(t.children,function(e){e.p=t,o(e)})}function s(t){-1!==l(t.name.toLowerCase()).indexOf(l(e.filterKeyword.toLowerCase()))?t.isFiltered=!1:n(t,e.filterKeyword)?t.isFiltered=!0:t.isFiltered=!1}c.callback&&(e.useCallback=!0),e.extraButtons&&(e.clearSearchIconStyle={right:"240px"}),e.$watch("inputModel",function(t){t&&(e.refreshSelectedItems(),e.refreshOutputModel())}),e.$watch("filterKeyword",function(){void 0!==e.filterKeyword&&(e.directSearch?angular.forEach(e.inputModel,function(e){o(e)}):angular.forEach(e.inputModel,function(e){s(e)}))})},controller:"multiSelectTreeCtrl"}})}(),function(){"use strict";var e=angular.module("multiselect-searchtree");e.controller("treeItemCtrl",["$scope",function(e){e.item.isExpanded!==!1&&e.item.isExpanded!==!0&&(e.item.isExpanded=!0),e.showExpand=function(e){return e.children&&e.children.length>0},e.onExpandClicked=function(e,t){t.stopPropagation(),e.isExpanded=!e.isExpanded},e.clickSelectItem=function(t,c){c.stopPropagation(),e.itemSelected&&e.itemSelected({item:t})},e.subItemSelected=function(t,c){e.itemSelected&&e.itemSelected({item:t})},e.activeSubItem=function(t,c){e.onActiveItem&&e.onActiveItem({item:t})},e.onMouseOver=function(t,c){c.stopPropagation(),e.onActiveItem&&e.onActiveItem({item:t})},e.showCheckbox=function(){return e.multiSelect?e.selectOnlyLeafs?!1:e.useCallback?e.canSelectItem(e.item):void 0:!1}}]),e.directive("treeItem",["$compile",function(e){return{restrict:"E",templateUrl:"src/tree-item.tpl.html",scope:{item:"=",itemSelected:"&",onActiveItem:"&",multiSelect:"=?",selectOnlyLeafs:"=?",isActive:"=",useCallback:"=",canSelectItem:"="},controller:"treeItemCtrl",compile:function(t,c,l){angular.isFunction(l)&&(l={post:l});var n,i=t.contents().remove();return{pre:l&&l.pre?l.pre:null,post:function(t,c,r){n||(n=e(i)),n(t,function(e){c.append(e)}),l&&l.post&&l.post.apply(null,arguments)}}}}}])}();